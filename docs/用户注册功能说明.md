# 用户注册功能说明

## 功能特性

### 安全防护

- 图形验证码（4 位随机字符）
- 防暴力破解（错误 5 次失效）
- 验证码 5 分钟过期
- 用户名黑名单
- 密码强度验证

### 表单验证

- 用户名：3-20 字符，字母、数字、下划线
- 密码：至少 6 位
- 实时验证提示

### 默认用户组

- 支持为新注册用户自动分配默认用户组
- 通过环境变量 `DEFAULT_REGISTRATION_GROUP` 配置
- 用户组需提前在管理面板创建

## 启用条件

1. 存储类型必须是：`redis`、`upstash` 或 `kvrocks`
2. 设置环境变量：`NEXT_PUBLIC_ENABLE_REGISTRATION=true`

## 配置示例

### Docker 部署

```yaml
environment:
  - NEXT_PUBLIC_STORAGE_TYPE=redis
  - NEXT_PUBLIC_ENABLE_REGISTRATION=true
  - DEFAULT_REGISTRATION_GROUP=普通用户
  - REDIS_URL=redis://redis:6379
```

### Vercel/ClawCloud

```bash
NEXT_PUBLIC_STORAGE_TYPE=upstash
NEXT_PUBLIC_ENABLE_REGISTRATION=true
DEFAULT_REGISTRATION_GROUP=普通用户
UPSTASH_URL=<your_url>
UPSTASH_TOKEN=<your_token>
```

## 环境变量说明

| 变量                            | 说明                         | 默认值 |
| ------------------------------- | ---------------------------- | ------ |
| NEXT_PUBLIC_ENABLE_REGISTRATION | 是否开启用户注册             | false  |
| DEFAULT_REGISTRATION_GROUP      | 注册用户默认分配的用户组名称 | 空     |

> **注意**：`DEFAULT_REGISTRATION_GROUP` 指定的用户组必须已在管理面板中创建，否则新注册用户将不会被分配到任何用户组。

## 使用流程

1. 访问 `/register` 页面
2. 填写用户名和密码
3. 输入图形验证码
4. 注册成功后自动跳转登录
5. 如配置了默认用户组，用户将自动加入该组

## 安全建议

- 建议用完即关闭注册功能
- 定期检查用户列表（`/admin` 页面）
- 及时封禁异常账号

## 常见问题

### 为什么显示"注册功能未开启"？

检查环境变量 `NEXT_PUBLIC_ENABLE_REGISTRATION` 是否设置为 `true`。

### 为什么显示"不支持注册"？

当前存储类型不支持多用户，需要使用 Redis/Upstash/Kvrocks。

### 注册后无法登录？

1. 检查数据库连接是否正常
2. 访问 `/admin` 查看用户是否创建成功
3. 确认用户未被封禁
